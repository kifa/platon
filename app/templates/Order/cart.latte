
{block pageheader}

        <div class="page-header">
        <h1 n:block="title"><i class="icon-shopping-cart"></i> {_'Your cart'} <small>{_'Here you can complete your order. Just fill fields bellow.'}</small></h1>
        </div>

{/block}
    
{block content}
<div class="span11" n:snippet="cartTable">    

    <table class="table span12 miniproduct">
    <thead class="table-bordered">
                <tr>
                    <th colspan="2"></th>
                    <th>{_'Product'}</th>
                    <th>{_'Amount'}</th>
                    <th>{_'Item price'}</th>
                    <th>{_'Total price'}</th>
                    
                </tr>
            </thead>
            
            <tbody >
{var $grandtotal = 0}
{foreach $cart as $id => $products}
    {foreach $products as $amnt => $product}
        {var $subtotal = $amnt * $product->FinalPrice}
                <tr>
                    <td>{*if $product->PhotoAlbumID}
                             <img src="{$basePath}/images/{$product->PhotoAlbumID}/50-{$product->PhotoURL}" class="img-circle" width="50"/>
                        {else}
                             <img src="{$basePath}/images/no_image.jpg" class="img-circle" class="span2" style="width: 38px;"/>
                        {/if} 
                        {*$product->ProductNumber*}</td>
                    <td><a n:href="removeItem! $id" class="ajax"><i class="icon-trash"></i></a></td>
                    <td><a href="{plink Product:product $product->ProductID}">{$product->ProductName} - {if $product->ProductVariantName}{$product->ProductVariantName}{/if}</a></td>
                    <td><a href="{plink addAmount! $id}" class="ajax"><i class="icon-plus-sign"></i></a> {$amnt} {_'pcs'}
                        
                        <a href="{plink removeAmount! $id}" class="ajax"><i class="icon-minus-sign"></i></a></td>
                    <td>{$product->FinalPrice},-</td>
                    <td>{$subtotal},-</td>
                    
                </tr>
           {var $grandtotal = $grandtotal + $subtotal}
    {/foreach}
{/foreach}
               
                <tr>
                    <td colspan="3"></td>
                    <td> <strong>{_'Shipping'}:</strong> 
                         <span class="shipping">0,-</span></td>
                    <td class="1"> <strong>{_'Total'}:</strong>
                         <span class="ordertotal">{$grandtotal},-</span></td>
                    <td><a href="#orderform" class="btn btn-warning"><i class="icon-arrow-down"></i> {_'Continue your Order'}</a></td>
                </tr>
                
            </tbody>
            
        </table>

<div class="span10 miniproduct thumbnail">
    <div class="">
    
        
        {form cartForm}
        <fieldset>
            
            <legend id="orderform"><span class="badge badge-info">1</span> {_'Choose your delivery option'}</legend>
    <div class="controls span12">
        <div class="span4">
           {ifset $lowerShippers}
            {label shippers /}
            {/ifset}
            <div>
           
            {input shippers}
            </div>
        </div>
        {ifset $lowerShippers}
        <div class="span8">
          {foreach $lowerShippers as $lower}
                {label lowerShippers$lower /}
            <div>
                {input lowerShippers$lower}
            </div>
            {/foreach}
        
        </div>
        {/ifset}
        <div class="span10 margin5"><strong>{_'Selected shipping:'} </strong><span class="shipping">{_'not selected'}</span></div>
    </div>
            <legend><span class="badge badge-info">2</span> {_'Fill contact information'}</legend>
            <div class="controls span5">
                
                {label name /}
                <div class="input-prepend">
                    <span class="add-on"><i class="icon-user"></i></span>
                {input name}
                </div>
                {label phone /}
                <div class="input-prepend">
                    <span class="add-on"><i class="icon-phone"></i></span>
                {input phone}
                </div>
                {label email /}
                <div class="input-prepend">
                    <span class="add-on">@</span>
                {input email}
                </div>
            </div>
            <div class="controls span6">
                {label address /}
                {input address}
                {label city /}
                {input city}
                {label zip /}
                {input zip}
            </div>    
            
            <legend><span class="badge badge-info">3</span> {_'Select Payment method'}</legend>
            <div class="controls span4">
                {label payment /}
                {input payment}
            </div>
            <legend><span class="badge badge-info">4</span> {_'Finish your order'}</legend>
            <div class="controls span5">
                {input send}
                <hr>
                {input termButton}
                {_'I accept Terms and condition.'}
                
            </div>
             <div class="controls span6">
                {label note /}
                {input note}
                 {input shipping}
            </div>
            </fieldset>
        {/form}
    </div>
<div class="span11 alert alert-info">   
                        <div class="span2">                    
                            <i class="icon-shopping-cart icon-4x"></i></div>
                        <div class="span10">
                            <h4 class="span4"><strong class="span12">{_'Products'}:</strong>
                                <span class="span12">{$grandtotal},-</span></h4>
                            <h4 class="span4"><strong class="span12">{_'Shipping'}:</strong> 
                                <span class="shipping span12">0,-</span></h4>
                            <h4 class="span4"><strong class="span12">{_'Total'}:</strong>
                                <span class="ordertotal span12">{$grandtotal},-</span></h4>
                        </div>
                    </div> 
    
    
    
      </div> 
{control modalControl:info terms, $terms->StaticTextName, $terms->StaticTextContent}
<script>

        var sp = new Array(); 
        {foreach $shippers as $id => $value}
                sp[{$id}] = {$value};
        {/foreach}
        
        
        var pm = new Array();
        {foreach $payment as $id => $value}
                pm[{$id}] = {$value};
        {/foreach}
        
       
        var shipping = 0;
        var payment = 0;

        $('select[name="shippers"]').change(function() {
            i = $('select[name="shippers"] option:selected').val();
            shipping = sp[i];
             var grandtotal = shipping + {$grandtotal} + payment;
        
        g = $('select[name="shippers"] option:selected').text();
        $('.shipping').html(g);
        $('.ordertotal').html(grandtotal + ',-'); 
        $('input[name=shipping]').val(i);
        //$('select[name="shippers"] option:selected').text().html().appendTo('#orderform');
        });
        
        
         {ifset $lowerShippers}
          {foreach $lowerShippers as $lower}
                    
        $('select[name="lowerShippers{!$lower}"]').change(function() {
            i = $('select[name="lowerShippers{!$lower}"] option:selected').val();
            shipping = sp[i];
             var grandtotal = shipping + {$grandtotal} + payment;
        $('input[name=shipping]').val(i);
        g = $('select[name="lowerShippers{!$lower}"] option:selected').text();
        $('.shipping').html(g);
        
        $('.ordertotal').html(grandtotal + ',-'); 
        });
        $('#sel0').fadeOut();
        
        $('#sel{!$lower}').fadeIn();
        
        {/foreach}
        {/ifset}
        
        
        $('select[name=payment]').change(function() {
            p = $('select[name=payment] option:selected').val();         
            payment = pm[p];

            var grandtotal = payment + {$grandtotal} + shipping;
        $('.ordertotal').html(grandtotal + ',-'); 
        });
        
            $('.ajax').click(function(){
    $(this).html('<i class="icon-spinner icon-spin"></i>');
});
</script>

</div>
{/block}

{block sidebar}
    
{/block}

    {block script}

{/block}

